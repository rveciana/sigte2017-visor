var viewer=new d3.viewer(d3.select("#viewer"),"config.json",createControls);function createControls(){var config=viewer.getConfig();var activeDataLayers=viewer.getActiveDataLayers();Object.keys(config.backgroundLayers).forEach(function(layer){var activeClass="";if(config.backgroundLayers[layer].active){activeClass="class='activeSelection' "}$("#backgroundSelect ul").append("<li value='"+layer+"' "+activeClass+"><a href='#'>"+layer+"</a></li>")});$("#backgroundSelect li").click(function(c){if($(this).hasClass("activeSelection")){$(this).removeClass("activeSelection");viewer.removeBackgroundLayer($(this).attr("value"))}else{$(this).addClass("activeSelection");viewer.addBackgroundLayer($(this).attr("value"))}});var dataOptions={};Object.keys(config.dataLayers).forEach(function(layerId){var model=config.dataLayers[layerId].model;var variable=config.dataLayers[layerId].variable;var level=config.dataLayers[layerId].level;if(!(model in dataOptions)){dataOptions[model]={}}if(!(variable in dataOptions[model])){dataOptions[model][variable]={}}dataOptions[model][variable][level]={active:config.dataLayers[layerId]["active"]?true:false,layerId:layerId,types:config.dataLayers[layerId]["type"]}});setDropdown();function setDropdown(){Object.keys(dataOptions).forEach(function(model){$("#dataSelectUl").append("<li id='"+model+"Options' class='dropdown-submenu'>");$("#"+model+"Options").append("<a tabindex='-1' href='#'>"+model+" <span class='caret'></span></a>");$("#"+model+"Options").append("<ul class='dropdown-menu' id='"+model+"variableSelect'>");Object.keys(dataOptions[model]).forEach(function(variable){$("#"+model+"variableSelect").append("<li id='"+model+variable+"Options' class='dropdown-submenu'>");$("#"+model+variable+"Options").append("<a tabindex='-1' href='#'>"+variable+" <span class='caret'></span></a>");$("#"+model+variable+"Options").append("<ul class='dropdown-menu' id='"+model+variable+"levelSelect'>");Object.keys(dataOptions[model][variable]).forEach(function(level){if(Array.isArray(dataOptions[model][variable][level]["types"])){$("#"+model+variable+"levelSelect").append("<li id='"+model+variable+level+"Options' class='dropdown-submenu'>");$("#"+model+variable+level+"Options").append("<a tabindex='-1' href='#'>"+level+" <span class='caret'></span></a>");$("#"+model+variable+level+"Options").append("<ul class='dropdown-menu' id='"+model+variable+level+"typeSelect'>");dataOptions[model][variable][level]["types"].forEach(function(type){$("#"+model+variable+level+"typeSelect").append("<li><a tabindex='-1' id='"+model+variable+level+type["type"]+"layerIdTypeSelection' href='#'>"+type["type"]+"</a></li>");$("#"+model+variable+level+type["type"]+"layerIdTypeSelection").click(function(c){viewer.toggleDataLayer(dataOptions[model][variable][level]["layerId"],type["type"]);setScales()})});$("#"+model+variable+"levelSelect").append("</ul></li>")}else{$("#"+model+variable+"levelSelect").append("<li><a tabindex='-1' href='#' id='"+model+variable+level+"layerIdSelection'>"+level+"</a></li>");$("#"+model+variable+level+"layerIdSelection").click(function(c){viewer.toggleDataLayer(dataOptions[model][variable][level]["layerId"]);setScales()})}$("#"+model+"variableSelect").append("</li>")});$("#"+model+"variableSelect").append("</ul>")});$("#dataSelect ul").append("</li>")});$(".dropdown-submenu a").on("click",function(e){$(this).next("ul").toggle();e.stopPropagation();e.preventDefault()})}function colorSelectedFields(){$("#modelSelect li ").removeClass("activeSelection");$("#variableSelect li ").removeClass("activeSelection");$("#levelSelect li ").removeClass("activeSelection");Object.keys(activeDataLayers).forEach(function(layer){$("#modelSelect li ").filter(function(index){return $(this).attr("value")===activeDataLayers[layer]["model"]}).addClass("activeSelection");$("#variableSelect li ").filter(function(index){return $(this).attr("value")===activeDataLayers[layer]["variable"]}).addClass("activeSelection");$("#levelSelect li ").filter(function(index){return $(this).attr("value")===activeDataLayers[layer]["level"]}).addClass("activeSelection")})}$("#downloadButton").click(function(){var dt=$("#viewer canvas").get(0).toDataURL("image/png");dt=dt.replace(/^data:image\/[^;]*/,"data:application/octet-stream");dt=dt.replace(/^data:application\/octet-stream/,"data:application/octet-stream;headers=Content-Disposition%3A%20attachment%3B%20filename=Canvas.png");this.href=dt;this.download="model.png"});function setScales(){$("#scalesSelectUl").empty();var activeDataLayers=viewer.getActiveDataLayers();Object.keys(activeDataLayers).forEach(function(layerName){if(config.dataLayers[layerName].type==="isobands"||config.dataLayers[layerName].type.some(function(el){return el.type==="isobands"&&activeDataLayers[layerName].type.indexOf("isobands")>=0})){config.dataLayers[layerName].scale.forEach(function(scaleName,i){$("#scalesSelectUl").append("<li><a tabindex='-1' href='#'><span id='"+scaleName+"'>"+scaleName+"</span> <span id='"+scaleName+"View' class='glyphicon glyphicon-eye-open'></a></li>");if(i===0){$("#"+scaleName).addClass("activeSelection")}$("#"+scaleName).click(function(c){viewer.setScale(layerName,scaleName);config.dataLayers[layerName].scale.forEach(function(scaleNameOld,i){$("#"+scaleNameOld).removeClass("activeSelection")});$("#"+scaleName).addClass("activeSelection")});$("#"+scaleName+"View").click(function(c){viewer.showScale(layerName,scaleName)})})}})}setScales();$("#ffButton").click(function(){var availableFrames=viewer.ff();if(!availableFrames){$("#ffButton").addClass("disabledButton")}$("#fbButton").removeClass("disabledButton")});$("#fbButton").click(function(){var availableFrames=viewer.fb();if(!availableFrames){$("#fbButton").addClass("disabledButton")}$("#ffButton").removeClass("disabledButton")});$("#playButton").click(function(){if($("#playButton span").hasClass("glyphicon-play")){$("#playButton span").removeClass("glyphicon-play");$("#playButton span").addClass("glyphicon-stop")}else{$("#playButton span").removeClass("glyphicon-stop");$("#playButton span").addClass("glyphicon-play")}viewer.playStop()});$(document).keydown(function(e){switch(e.which){case 37:var availableFrames=viewer.fb();if(!availableFrames){$("#fbButton").addClass("disabledButton")}$("#ffButton").removeClass("disabledButton");break;case 38:break;case 39:var availableFrames=viewer.ff();if(!availableFrames){$("#ffButton").addClass("disabledButton")}$("#fbButton").removeClass("disabledButton");case 40:break;default:return}e.preventDefault()});var calendarElement=$("<input type='text' class='calendar'/>");$("#calendar").append(calendarElement);calendarElement.datepicker({dateFormat:"yy-mm-dd",maxDate:new Date(Date.now()),minDate:new Date(2014,0,1),changeYear:true,onSelect:function(date){var newDate=new Date(date);newDate.setUTCHours(parseInt($("input[name=selectedHour]:checked","#calendar").val()));viewer.setDate(newDate)}.bind(this)});calendarElement.datepicker("setDate",new Date(Date.now()));var hoursGroup="<div class='btn-group' data-toggle='buttons'>";$("#calendar").append(hoursGroup);var hour00=$("<label class='btn btn-primary active'><input id='kk' type='radio' name='selectedHour' value='00' autocomplete='off' checked>00</label>");$("#calendar .btn-group").append(hour00);hour00.click(function(){var newDate=calendarElement.datepicker("getDate");newDate=new Date(newDate.setTime(newDate.getTime()+72e5));newDate.setUTCHours(0);viewer.setDate(newDate)});var hour12=$("<label class='btn btn-primary'><input type='radio' name='selectedHour' value='12' autocomplete='off'>12</label>");$("#calendar .btn-group").append(hour12);hour12.click(function(){var newDate=calendarElement.datepicker("getDate");newDate=new Date(newDate.setTime(newDate.getTime()+72e5));newDate.setUTCHours(12);viewer.setDate(newDate)})}
